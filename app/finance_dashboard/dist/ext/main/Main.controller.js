sap.ui.define(["sap/fe/core/PageController","sap/m/MessageToast","sap/ui/export/Spreadsheet","sap/ui/model/json/JSONModel"],function(e,t,n,r){"use strict";const{ajax:o}=$;let a,s;return e.extend("financedashboard.ext.main.Main",{onInit:function(){a=new r({KPI:[{header:"Pending Approvals",subHeader:"Pending",value:0,valueColor:"Critical"},{header:"Approved Requests",subHeader:"Approved",value:0,valueColor:"Good"},{header:"Rejected Requests",subHeader:"Rejected",value:0,valueColor:"Error"}]});s=this.getView();s.setModel(a,"localModel");this.getAppComponent().getRouter(this).getRoute("TravelRequestMain").attachPatternMatched(this._onMainMatched,this)},onAfterRendering:function(){},_onFetchTableAndKPI:function(){const e=this.getOwnerComponent().getModel().getServiceUrl(),{KPI:t}=a.getData(),n=t.map(function(t){return o({method:"GET",url:`${e}TravelRequest/$count?$filter=startswith(reqstatus,'${t.subHeader}')`})});s.setBusy(true);Promise.all(n).then(function(e){a.setProperty("/KPI",t.map(function(t,n){t.value=e[n];return t}))}).catch(console.error).finally(function(){s.setBusy(false)});s.byId("idTable").getBinding("items").refresh()},_onMainMatched:function(){this._onFetchTableAndKPI()},onShare:function(){const e=window.location.href,t="Check out this Travel Plan!",n="Hi,\n\nI found this interesting travel plan. Check it out: "+e,r=document.createElement("a"),o="mailto:?subject="+encodeURIComponent(t)+"&body="+encodeURIComponent(n);r.href=o;r.click()},onExport:function(e){const r=this.getView().byId("idTable");if(e==="CSV"){sap.ui.core.util.File.save(["Request No.,Employee Name,Department,Travel Purpose,Travel Status",...r.getItems().map(e=>e.getCells().map(e=>`"${e.getText()}"`).join(","))].join("\n"),"TravelPlans","csv","text/csv",true)}else if(e==="XLSX"){const e=[{label:"Request No.",property:"REQID",type:"string"},{label:"Employee Name",property:["firstname","lastname"],type:"string"},{label:"Department",property:"dept",type:"string"},{label:"Travel Purpose",property:"purposeoftravel",type:"string"},{label:"Travel Status",property:"reqstatus",type:"string"}],o={workbook:{columns:e,hierarchyLevel:"Level"},dataSource:r.getBinding("items"),fileName:"TravelPlans.xlsx",worker:false},a=new n(o);a.build().then(function(){t.show("Spreadsheet export has finished successfully.")}).catch(function(e){t.show("Error when downloading spreadsheet. "+e)}).finally(function(){a.destroy()})}},onNavigate:function(e){const t=this.getAppComponent().getRouter(this),n=e.getSource().getBindingContext().getObject("ID");t.navTo("TravelRequestDetail",{ID:n})},onExit:function(){clearInterval(this._RefreshInterval)},_onFormatState:function(e){if(!e){return}switch(e){case"ApprovedF":case"ApprovedM":return"Success";case"RejectedF":return"Error";case"Completed":return"Success";default:return"Warning"}},_onFormatStateIcon:function(e){if(!e){return}switch(e){case"ApprovedF":case"ApprovedM":return"sap-icon://accept";case"RejectedF":return"sap-icon://error";case"Completed":return"sap-icon://completed";default:return"sap-icon://pending"}},_onFormatStateText:function(e){if(!e){return}switch(e){case"ApprovedF":case"ApprovedM":return"Approved";case"RejectedF":case"RejectedM":return"Rejected";case"Completed":return"Completed";default:return"Pending"}}})});
//# sourceMappingURL=Main.controller.js.map